<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Hands–On Data Visualization with ggplot2 – Segment 4 – Cédric Scherer</title>
    <meta charset="utf-8" />
    <meta name="author" content="Cédric Scherer" />
    <meta name="date" content="2021-12-23" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link rel="stylesheet" href="css/style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: inverse, center
background-image: url("img/darklight_RichardStrozynski.jpg")
background-size: contain



&lt;br&gt;&lt;br&gt;
# Hands–On Data Visualization with &lt;code style='color:#ebc500;'&gt;ggplot2&lt;/code&gt;&lt;br&gt;&lt;b style='font-size:25pt;color:#a7a7a7;'&gt;Segment 4: Provide Context with Annotations&lt;/b&gt;
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
#### Dr. Cédric Scherer&lt;b style='color:#ccba56;font-weight:400;line-height:150%;'&gt;&lt;br&gt;Pearson Live Training Session for O'Reilly&lt;br&gt;December 17, 2021&lt;/b &gt;&lt;br&gt;



---
class: inverse, center, middle

# &lt;b style='font-size:70pt;color:#ebc500;'&gt;Titles, Labels &amp; Co&lt;/b&gt;&lt;br&gt;&lt;br&gt;

---

## Labels: &lt;b&gt;&lt;code&gt;labs()&lt;/code&gt;&lt;/b&gt;

To change the labels and add a title, a subtitle, a caption and/or a tag, use `labs()`:


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
* labs(x = NULL, y = "Closing Price", color = "Cryptocurrency:")
```

&lt;img src="04-annotation_files/figure-html/structure-labs-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Labels: &lt;b&gt;&lt;code&gt;labs()&lt;/code&gt;&lt;/b&gt;

There are multiple ways to add labels:

.pull-left[

```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
* xlab(NULL) +
  # scale_x_date(name = NULL) +
* ylab("Closing Price") +
  # scale_y_continuous(name = "Closing Price") +
* scale_color_discrete(name = "Cryptocurrency:")
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-structure-labs-alt-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Labels: &lt;b&gt;&lt;code&gt;labs()&lt;/code&gt;&lt;/b&gt;

To change the labels and add a title, a subtitle, a caption and/or a tag, use `labs()`:


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
  labs(x = NULL, y = "Closing Price", color = "Cryptocurrency:",
*      title = "Performance of the Top 4 Cryptocurrencies", caption = "Data: CoinMarketCap.com",
*      subtitle = "The time series show daily closing prices from 2018 to 2020.", tag = "A)")
```

&lt;img src="04-annotation_files/figure-html/structure-titles-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Plot Position

.pull-left[

```r
ggplot(data, aes(close, currency)) +
  geom_boxplot() +
  ggtitle("Closing Prices of the Top 4 Cryptocurrencies, 2018–2020") +
* theme(plot.title.position = "panel")
```

&lt;img src="04-annotation_files/figure-html/boxplot-title-position-panel-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

.pull-right[

```r
ggplot(data, aes(close, currency)) +
  geom_boxplot() +
  ggtitle("Closing Prices of the Top 4 Cryptocurrencies, 2018–2020") +
* theme(plot.title.position = "plot")
```

&lt;img src="04-annotation_files/figure-html/boxplot-title-position-plot-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package provides simple Markdown and HTML rendering for `{ggplot2}`.

---
background-image: url("img/bg-poll.png")
background-size: cover

## POLL: What is your level of expertise?

&lt;ul style='font-size:26pt;margin: 50px 50px;'&gt;
&lt;li style='margin-bottom: 15px;'&gt;I know neither Markdown nor HTML.&lt;/li&gt;
&lt;li style='margin-bottom: 15px;'&gt;I use Markdown but not HTML.&lt;/li&gt;
&lt;li style='margin-bottom: 15px;'&gt;I use HTML (basic) but not Markdown.&lt;/li&gt;
&lt;li style='margin-bottom: 15px;'&gt;I use HTML (extensively) but not Markdown.&lt;/li&gt;
&lt;li style='margin-bottom: 15px;'&gt;I use HTML (basic) &lt;u&gt;and&lt;/u&gt; Markdown.&lt;/li&gt;
&lt;li style='margin-bottom: 15px;'&gt;I use HTML (extensively) &lt;u&gt;and&lt;/u&gt; Markdown.&lt;/li&gt;
&lt;/ul&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package provides simple &lt;u&gt;Markdown&lt;/u&gt; and HTML rendering for `{ggplot2}`.


```r
#install.packages("ggtext")
*library(ggtext)
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
* labs(title = "Performance of the **Top 4 Cryptocurrencies**", caption = "Data: *CoinMarketCap.com*")
```

&lt;img src="04-annotation_files/figure-html/ggtext-showcase-raw-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package provides simple &lt;u&gt;Markdown&lt;/u&gt; and HTML rendering for `{ggplot2}`.


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
  labs(title = "Performance of the **Top 4 Cryptocurrencies**", caption = "Data: *CoinMarketCap.com*") + 
* theme(plot.title = element_markdown(), plot.caption = element_markdown())
```

&lt;img src="04-annotation_files/figure-html/ggtext-showcase-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package provides simple Markdown and &lt;u&gt;HTML&lt;/u&gt; rendering for `{ggplot2}`.


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
* labs(title = "Performance of the &lt;b style='font-size:34pt;'&gt;Top 4 Cryptocurrencies&lt;/b&gt;",
*      caption = "&lt;span style='color:firebrick;'&gt;Data:&lt;/span&gt; &lt;i&gt;CoinMarketCap.com&lt;/i&gt;") +
  theme(plot.title = element_markdown(), plot.caption = element_markdown())
```

&lt;img src="04-annotation_files/figure-html/ggtext-showcase-2-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

`element_textbox` and `element_textbox_simple` automatically wrap long text:


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
* labs(title = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Accumsan tortor posuere ac ut consequat semper viverra nam libero.") +
* theme(plot.title = element_textbox_simple())
```

&lt;img src="04-annotation_files/figure-html/ggtext-wrap-title-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

`element_textbox` and `element_textbox_simple` automatically wrap long text:


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
  labs(title = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Accumsan tortor posuere ac ut consequat semper viverra nam libero.") + 
* theme(plot.title = element_textbox_simple(margin = margin(b = 15), lineheight = .9))
```

&lt;img src="04-annotation_files/figure-html/ggtext-wrap-title-2-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

`element_textbox` and `element_textbox_simple` automatically wrap long text:


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
  labs(title = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Accumsan tortor posuere ac ut consequat semper viverra nam libero.") +
  theme(plot.title = element_textbox_simple(margin = margin(b = 15), lineheight = .9,
*                                           linetype = 1, padding = margin(rep(10, 4))))
```

&lt;img src="04-annotation_files/figure-html/ggtext-wrap-title-3-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Text Rendering with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

`element_textbox` and `element_textbox_simple` automatically wrap long text:


```r
ggplot(data, aes(date, close, color = currency)) +
  geom_line() + 
  labs(title = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Accumsan tortor posuere ac ut consequat semper viverra nam libero.") +
  theme(plot.title = element_textbox_simple(margin = margin(b = 15), lineheight = .9,
                                            linetype = 1, padding = margin(rep(10, 4)),
*                                           r = unit(10, "pt"), fill = "moccasin"))
```

&lt;img src="04-annotation_files/figure-html/ggtext-wrap-title-4-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---
class: inverse, center, middle

# &lt;b style='font-size:70pt;color:#ebc500;'&gt;Basic Text Labelling&lt;/b&gt;&lt;br&gt;&lt;br&gt;

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
* annotate(
*   geom = "text",
*   x = 250,
*   y = 50,
*   label = "Some\nadditional\ntext"
* )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate( 
    geom = "text", 
    x = 250, 
    y = 50,
    label = "Some\nadditional\ntext",
*   size = 6,
*   color = "firebrick",
*   fontface = "bold",
*   lineheight = .9
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-adj-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate(
*   geom = "rect",
*   xmin = 150,
*   xmax = Inf,
*   ymin = 150,
*   ymax = Inf,
*   fill = "firebrick"
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-box-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  annotate(
    geom = "rect", 
    xmin = 150, 
    xmax = Inf, 
    ymin = 150, 
    ymax = Inf,
    fill = "firebrick"
  ) +
* geom_point(size = 2)
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-box-adj-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate(
    geom = "text", 
    x = 250, y = 50,
    label = "Some\nadditional\ntext",
    size = 6,
    lineheight = .9 
  ) +
* annotate(
*   geom = "segment",
*   x = 250, y = 75,
*   xend = 180, yend = 160
* )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-line-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate(
    geom = "text", 
    x = 250, y = 50,
    label = "Some\nadditional\ntext",
    size = 6,
    lineheight = .9 
  ) +
  annotate(
*   geom = "curve",
    x = 250, y = 75, 
    xend = 180, yend = 160
  ) 
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-curve-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate( 
    geom = "text", 
    x = 250, y = 50,
    label = "Some\nadditional\ntext",
    size = 6,
    lineheight = .9 
  ) +
  annotate(
    geom = "curve",
    x = 250, y = 75, 
    xend = 180, yend = 160,
*   curvature = .4,
*   arrow = arrow()
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-arrow-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate( 
    geom = "text", 
    x = 250, y = 50,
    label = "Some\nadditional\ntext",
    size = 6,
    lineheight = .9 
  ) +
  annotate(
    geom = "curve",
    x = 250, y = 75, 
    xend = 180, yend = 160,
    curvature = .4,
*   arrow = arrow(length = unit(0.4, "lines"),
*                 type = "closed",
*                 ends = "both")
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-arrow-type2-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;

The `annotate()` function allows to add geom's to a plot without mapping to variables to aesthetics:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  annotate( 
    geom = "text", 
    x = 250, y = 50,
    label = "Some\nadditional\ntext",
    size = 6,
    lineheight = .9 
  ) +
  annotate(
    geom = "curve",
    x = 250, y = 75, 
    xend = 180, yend = 160,
    curvature = .8, 
*   angle = 130,
    arrow = arrow(length = unit(0.4, "lines"),
                  type = "closed",
                  ends = "both")
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotate-text-arrow-skewed-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
background-image: url("img/bg-exercise.png")
background-size: cover

## Exercise 1:

* Create the following visualization:

&lt;img src="04-annotation_files/figure-html/exercise-plot-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 1: Create Line Plot


```r
(g &lt;- ggplot(data, aes(date, close, color = currency)) + 
  geom_line(size = 1) +
  scale_x_date(expand = c(0, 0)) +
  scale_y_continuous(labels = scales::dollar_format()) +
  scale_color_brewer(palette = "Set1", guide = "none") +
  labs(x = NULL, y = NULL, title = "Closing Prices of the Top 4 Cryptocurrencies"))
```

&lt;img src="04-annotation_files/figure-html/exercise-plot-basic-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 1: Modify Theme


```r
(g &lt;- g +
  theme_classic(base_size = 20) +
  theme(plot.title.position = "plot"))
```

&lt;img src="04-annotation_files/figure-html/exercise-plot-theme-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 1: Add Annotations with &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;


```r
annotate &lt;- data %&gt;% group_by(currency) %&gt;% filter(close == max(close))

annotate
## # A tibble: 4 x 9
## # Groups:   currency [4]
##   currency     date        open  high   low close  year month  yday
##   &lt;chr&gt;        &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 binance-coin 2019-06-21  36.7  38.9  36.3  38.8  2019     6   172
## 2 eos          2018-04-29  18.9  22.9  18.9  21.5  2018     4   119
## 3 litecoin     2018-01-06 250.  323.  249.  296.   2018     1     6
## 4 bitcoin-sv   2019-06-22 222.  256.  222.  238.   2019     6   173
```

---

## Exercise 1: Add Annotations with &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;


```r
g + 
  annotate(geom = "text", x = annotate$date, y = annotate$close + 10,
           label = annotate$currency, hjust = 0, size = 5, fontface = "bold")
```

&lt;img src="04-annotation_files/figure-html/exercise-annotate-each-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 1: Add Annotations with &lt;b&gt;&lt;code&gt;annotate()&lt;/code&gt;&lt;/b&gt;


```r
g + 
  annotate(geom = "text", x = annotate$date[1], y = annotate$close[1] + 10,
           label = annotate$currency[1], hjust = 0, size = 6, fontface = "bold", color = "#E41A1C") + 
  annotate(geom = "text", x = annotate$date[2], y = annotate$close[2] + 10,
           label = annotate$currency[2], hjust = 0, size = 6, fontface = "bold", color = "#4DAF4A") + 
  annotate(geom = "text", x = annotate$date[3], y = annotate$close[3] + 10,
           label = annotate$currency[3], hjust = 0, size = 6, fontface = "bold", color = "#984EA3") + 
  annotate(geom = "text", x = annotate$date[4], y = annotate$close[4] + 10,
           label = annotate$currency[4], hjust = 0, size = 6, fontface = "bold", color = "#377EB8")
```

&lt;img src="04-annotation_files/figure-html/exercise-annotate-each-col-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 1: Add Annotations with &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;


```r
g +
  geom_text(data = annotate,
            aes(label = currency), size = 6, nudge_y = 10, hjust = 0, fontface = "bold")
```

&lt;img src="04-annotation_files/figure-html/exercise-plot-geom-text-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 1: Add Annotations with &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;


```r
g +
  geom_text(data = data %&gt;% group_by(currency) %&gt;% filter(close == max(close)),
            aes(label = currency), size = 6, nudge_y = 10, hjust = 0, fontface = "bold")
```

&lt;img src="04-annotation_files/figure-html/exercise-plot-geom-text-data-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Annotations via &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;

You already know `geom_text()`:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
* geom_text(
*   aes(label = currency),
*   size = 5
* )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-text-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;

Let's tag only those days that are considerably far from the diagonal:


```r
outliers &lt;- data %&gt;%
  mutate(dist = abs(close - open) / sqrt(2)) %&gt;% 
  filter(dist &gt; 20)
```

---

## Annotations via &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;

Let's tag only those days that are considerably far from the diagonal:


```r
outliers &lt;- data %&gt;%
  mutate(dist = abs(close - open) / sqrt(2)) %&gt;% 
  filter(dist &gt; 20)

outliers
## # A tibble: 14 x 10
##    currency   date        open  high   low close  year month  yday  dist
##    &lt;chr&gt;      &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 litecoin   2018-02-14 160.   218. 160.  213.   2018     2    45  38.0
##  2 litecoin   2018-02-03 131.   166. 121.  160.   2018     2    34  20.4
##  3 litecoin   2018-01-16 233.   233. 152.  188.   2018     1    16  31.5
##  4 litecoin   2018-01-08 288.   289. 238.  256.   2018     1     8  22.6
##  5 litecoin   2018-01-06 250.   323. 249.  296.   2018     1     6  33.0
##  6 bitcoin-sv 2019-09-24 114.   115.  71.0  83.8  2019     9   267  21.3
##  7 bitcoin-sv 2019-06-03 192.   236. 192.  221    2019     6   154  20.5
##  8 bitcoin-sv 2019-05-29 122.   201. 115.  201.   2019     5   149  56.2
##  9 bitcoin-sv 2019-05-21  63.2  139.  61.7 104.   2019     5   141  29.1
## 10 bitcoin-sv 2018-11-19 106.   108.  69.7  72.1  2018    11   323  23.9
## 11 bitcoin-sv 2018-11-16  94.5  134.  76.8 123.   2018    11   320  20.2
## 12 bitcoin-sv 2018-11-15 176.   180.  71.0  93.7  2018    11   319  58.4
## 13 bitcoin-sv 2018-11-14 206.   244. 155.  175.   2018    11   318  21.9
## 14 bitcoin-sv 2018-11-13 110.   208. 109.  208.   2018    11   317  69.7
```

---

## Annotations via &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;

We can use both data sets in the same ggplot:

.pull-left[

```r
ggplot(outliers, aes(close, open)) + 
* geom_point(data = data, color = "grey80") +
  geom_point(size = 2) +
  geom_text(
    aes(label = currency),
    size = 5
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-text-outlier-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;

We can offset the labels with the help of the nudge arguments:

.pull-left[

```r
ggplot(outliers, aes(close, open)) + 
* geom_point(data = data, color = "grey80") +
  geom_point(size = 2) +
  geom_text(
    aes(label = currency),
    size = 5,
*   hjust = 0,
*   nudge_x = 5,
*   nudge_y = -5
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-text-outlier-adj-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom_text|label()&lt;/code&gt;&lt;/b&gt;

We can offset the labels with the help of the nudge arguments:

.pull-left[

```r
ggplot(outliers, aes(close, open)) + 
  geom_point(data = data, color = "grey80") + 
  geom_point(size = 2) +
  geom_text(
    aes(label = currency),
    size = 5,
    hjust = 0,
    nudge_x = 5, 
    nudge_y = -5 
  ) +
  scale_x_continuous(
    limits = c(NA, 320)
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-text-outlier-adj-limits-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
class: inverse, center, middle

# &lt;b style='font-size:70pt;color:#ebc500;'&gt;Advanced Text Labelling&lt;/b&gt;&lt;br&gt;&lt;br&gt;

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_text|label\_repel()&lt;/code&gt;&lt;/b&gt;

The `{ggrepel}` package provides two geom's to repel overlapping text labels:

.pull-left[
&lt;img src="04-annotation_files/figure-html/geom-text-comp-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/geom-text-repel-comp-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_text|label\_repel()&lt;/code&gt;&lt;/b&gt;

The `{ggrepel}` package provides two geom's to repel overlapping text labels:

.pull-left[

```r
#install.packages("ggrepel")

ggplot(outliers, aes(close, open)) + 
  geom_point(data = data, color = "grey80") +
  geom_point(size = 2) +
* ggrepel::geom_text_repel(
    aes(label = currency),
    size = 5,
    hjust = 0
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-text-repel-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_text|label\_repel()&lt;/code&gt;&lt;/b&gt;

The `{ggrepel}` package provides two geom's to repel overlapping text labels:

.pull-left[

```r
#install.packages("ggrepel")

ggplot(outliers, aes(close, open)) + 
  geom_point(data = data, color = "grey80") +
  geom_point(size = 2) +
* ggrepel::geom_label_repel(
    aes(label = currency),
    size = 5
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-label-repel-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_text|label\_repel()&lt;/code&gt;&lt;/b&gt;

The `{ggrepel}` package provides two geom's to repel overlapping text labels:

.pull-left[

```r
#install.packages("ggrepel")

ggplot(outliers, aes(close, open)) + 
  geom_point(data = data, color = "grey80") +
  geom_point(size = 2) +
  ggrepel::geom_label_repel(
    aes(label = currency),
    size = 5,
    ## space between points + labels
*   box.padding = .5,
    ## always draw segments
*   min.segment.length = 0
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-label-repel-adj-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

For illustration purposes we use a data set about Palmer penguins (Horst, Hill &amp; Gorman 2020).

.pull-left[

```r
penguins &lt;- read_csv(
  here::here("data", "penguins.csv")
)

(g &lt;- 
  ggplot(
    penguins, 
    aes(flipper_length_mm, bill_length_mm,
        color = species)
    ) + 
    geom_point(show.legend = FALSE) 
)
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-penguin-scatter-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
#install.packages("ggforce")

g +
  ggforce::geom_mark_ellipse(
    aes(label = species)
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-ellipse-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
class: center, middle
exclude: true

&lt;img src="04-annotation_files/figure-html/plot-geom-mark-ellipse-again-1.png" width="1008" style="display: block; margin: auto;" /&gt;

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
g +
  ggforce::geom_mark_ellipse(
    aes(label = species)
  ) +
* coord_cartesian(
*   xlim = c(160, 250),
*   ylim = c(20, 70)
* )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-ellipse-desc-adj-again-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
class: center, middle
exclude: true

&lt;img src="04-annotation_files/figure-html/plot-geom-mark-ellipse-desc-adj-1.png" width="1008" style="display: block; margin: auto;" /&gt;

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
g +
  ggforce::geom_mark_ellipse(
    aes(label = species,
*       description = latin_name)
  ) +
  coord_cartesian( 
    xlim = c(160, 250), 
    ylim = c(20, 70)
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-ellipse-desc-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
class: center, middle
exclude: true

&lt;img src="04-annotation_files/figure-html/geom-mark-ellipse-desc-again-1.png" width="1008" style="display: block; margin: auto;" /&gt;

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
g +
  ggforce::geom_mark_ellipse(
    aes(label = species,
*       filter = species == "Adelie")
  ) +
  coord_cartesian( 
    xlim = c(165, NA),
    ylim = c(25, NA)
  ) +
  theme(legend.position = "none")
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-ellipse-filter-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
g +
* ggforce::geom_mark_circle(
    aes(label = species,
        filter = species == "Adelie") 
  ) +
  coord_cartesian( 
    xlim = c(165, NA),
    ylim = c(25, NA)
  ) +
  theme(legend.position = "none")
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-circle-filter-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
g +
* ggforce::geom_mark_rect(
    aes(label = species,
        filter = species == "Adelie")
  ) +
  coord_cartesian( 
    xlim = c(165, NA),
    ylim = c(25, NA)
  ) +
  theme(legend.position = "none")
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-rect-filter-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations via &lt;b&gt;&lt;code&gt;geom\_mark\_*()&lt;/code&gt;&lt;/b&gt;

The `{ggforce}` package provides functionality to highlight groups:

.pull-left[

```r
g +
* ggforce::geom_mark_hull(
    aes(label = species,
        filter = species == "Adelie") 
  ) +
  coord_cartesian( 
    xlim = c(165, NA),
    ylim = c(25, NA)
  ) +
  theme(legend.position = "none")
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-geom-mark-hull-filter-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
class: inverse, center, middle

# &lt;b style='font-size:70pt;color:#ebc500;'&gt;Add Images&lt;/b&gt;&lt;br&gt;&lt;br&gt;

---

## Add Images via &lt;b&gt;&lt;code&gt;annotation_custom()&lt;/code&gt;&lt;/b&gt;

`magick::image_read()` allows to directly store images from the web in `R`:


```r
#install.packages("magick")
url &lt;- "https://image.shutterstock.com/image-vector/set-gold-silver-crypto-currencies-260nw-775898248.jpg"
img &lt;- magick::image_read(url)

img
```

&lt;img src="04-annotation_files/figure-html/annotation-custom-img-prep-1.png" width="394" style="display: block; margin: auto;" /&gt;


---

## Add Images via &lt;b&gt;&lt;code&gt;annotation_custom()&lt;/code&gt;&lt;/b&gt;

`annotation_custom()` in combination with `grid::rasterGrob()` allows to add images:

.pull-left[

```r
ggplot(data, aes(date, close, color = currency)) +
* annotation_custom(
*   grid::rasterGrob(
*     image = img
*   )
* ) +
  geom_line(size = .8)
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotation-custom-img-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Add Images via &lt;b&gt;&lt;code&gt;annotation_custom()&lt;/code&gt;&lt;/b&gt;

`annotation_custom()` in combination with `grid::rasterGrob()` allows to add images:

.pull-left[

```r
ggplot(data, aes(date, close, color = currency)) +
  annotation_custom(
    grid::rasterGrob(
      image = img,
*     width = unit(.4, "npc")
    ) 
  ) +
  geom_line(size = .8) 
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotation-custom-img-mod-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Add Images via &lt;b&gt;&lt;code&gt;annotation_custom()&lt;/code&gt;&lt;/b&gt;

`annotation_custom()` in combination with `grid::rasterGrob()` allows to add images:

.pull-left[

```r
ggplot(data, aes(date, close, color = currency)) +
  annotation_custom(
    grid::rasterGrob(
      image = img,
*     x = .5,
*     y = .9,
*     width = .9
    ) 
  ) +
  geom_line(size = .8)
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotation-custom-img-mod2-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Add Images via &lt;b&gt;&lt;code&gt;annotation_custom()&lt;/code&gt;&lt;/b&gt;

`annotation_custom()` in combination with `grid::rasterGrob()` allows to add images:

.pull-left[

```r
ggplot(data, aes(date, close, color = currency)) +
  annotation_custom(
    grid::rasterGrob(
        image = img,
        x = .5,
*       y = -.25,
        width = .9 
    ) 
  ) +
  geom_line(size = .8) +
* coord_cartesian(clip = "off") +
* theme(plot.margin = margin(12, 12, 130, 12))
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-annotation-custom-img-below-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Add Images with the &lt;b&gt;&lt;code&gt;{cowplot}&lt;/code&gt;&lt;/b&gt; Package

The `cowplot` package can also be used to add images:

.pull-left[

```r
#install.packages("cowplot")
g &lt;- ggplot(data, aes(close, open)) +
  geom_point(alpha = .4) +
  theme(plot.margin = margin(12, 12, 70, 12))

*cowplot::ggdraw(g) +
* cowplot::draw_image(
*   img,
*   scale = 1
* )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-cowplot-img-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Add Images with the &lt;b&gt;&lt;code&gt;{cowplot}&lt;/code&gt;&lt;/b&gt; Package

The `cowplot` package can not only add plots to other plots but also images:

.pull-left[

```r
g &lt;- ggplot(data, aes(close, open)) +
  geom_point(alpha = .4) +
* theme(panel.background = element_blank(),
*       plot.background = element_blank())

*cowplot::ggdraw() +
  cowplot::draw_image(
    img, 
    scale = 1
  ) +
* cowplot::draw_plot(g)
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-cowplot-img-2-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Add Images with the &lt;b&gt;&lt;code&gt;{cowplot}&lt;/code&gt;&lt;/b&gt; Package

The `cowplot` package can also be used to add images:

.pull-left[

```r
g &lt;- ggplot(data, aes(close, open)) +
  geom_point(alpha = .4) +
  theme(plot.margin = margin(12, 12, 45, 12))

url &lt;- "https://upload.wikimedia.org/wikipedia/en/thumb/3/35/Pearson_logo.svg/1280px-Pearson_logo.svg.png"
logo &lt;- magick::image_read(url)

cowplot::ggdraw(g) +
  cowplot::draw_image(
    logo,  
    scale = .2, 
    x = 1,
    hjust = 1, 
*   halign = 1,
*   valign = 0
  )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-cowplot-img-3-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---
background-image: url("img/bg-exercise.png")
background-size: cover

## Exercise 2:

* Play around with the two different approaches and how they differ in placing and scaling the images.

* **Bonus:** Write a function that lets you add your company's logo to a ggplot object.

---

## Exercise 2: 


```r
add_logo &lt;- function(g) {
  url &lt;- "https://upload.wikimedia.org/wikipedia/en/thumb/3/35/Pearson_logo.svg/1280px-Pearson_logo.svg.png"
  logo &lt;- magick::image_read(url)
  
  g &lt;- g +
    theme(plot.margin = margin(12, 12, 45, 12))
  
  plot &lt;- 
    cowplot::ggdraw(g) +
    cowplot::draw_image(
      logo,  
      scale = .2, 
      x = 1,
      hjust = 1, 
      halign = 1, 
      valign = 0
    )
  
  return(plot)
}
```

---

## Exercise 2: 


```r
my_plot &lt;- ggplot(data, aes(close, open)) + geom_point()
add_logo(my_plot)
```

&lt;img src="04-annotation_files/figure-html/logo-function-test-a-1.png" width="864" style="display: block; margin: auto;" /&gt;

---

## Exercise 2: 


```r
my_plot &lt;- ggplot(data, aes(close, open)) + geom_point()
add_logo(my_plot)
```

&lt;img src="04-annotation_files/figure-html/logo-function-test-b-1.png" width="360" style="display: block; margin: auto;" /&gt;

---

## Exercise 2: 


```r
my_plot &lt;- ggplot(data, aes(close, open)) + geom_point()
add_logo(my_plot)
```

&lt;img src="04-annotation_files/figure-html/logo-function-test-c-1.png" width="1152" style="display: block; margin: auto;" /&gt;

---

## Resources

* Chapter 8 [Annotations](https://ggplot2-book.org/annotations.html) of the “ggplot2” book by Hadley Wickham et al.

* Chapter 7 [Annotations](https://r-graphics.org/chapter-annotate) of the “R Graphics Cookbook” book by Winston Chang

* [“Add a Logo to Your Plot”](https://themockup.blog/posts/2019-01-09-add-a-logo-to-your-plot/), blog post by Thomas Mock

* [“How to Add a Logo to ggplot by Magick”](https://www.danielphadley.com/ggplot-logo/), blog post by Daniel Hadley

* [“A `{ggplot2}` Tutorial for Beautiful Plotting in R”](https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/), my extensive "how to"-tutorial

---
class: inverse, center, middle

# &lt;b style='font-size:70pt;color:lightgray;'&gt;APPENDIX&lt;/b&gt;&lt;br&gt;&lt;br&gt;

---

## Annotations with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package also comes with two geom's: `geom_richtext()` and `geom_textbox()`:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
* geom_richtext(
*   aes(
*     x = 250, y = 50,
*     label = "Some&lt;br&gt;**additional**&lt;br&gt;text"
*   ),
*   stat = "unique"
* )
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-ggtext-richtext-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package also comes with two geom's: `geom_richtext()` and `geom_textbox()`:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  geom_richtext( 
    aes(
      x = 250, y = 50,  
        label = "Some&lt;br&gt;**additional**&lt;br&gt;text" 
    ),  
    stat = "unique",
*   color = "firebrick",
*   size = 5,
*   fill = NA,
*   label.color = NA
  ) 
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-ggtext-richtext-2-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package also comes with two geom's: `geom_richtext()` and `geom_textbox()`:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
* geom_textbox(
    aes(
      x = 210, y = 50,  
*     label =  "**Lorem ipsum** dolor sit amet, *consectetur adipiscing elit,* sed do eiusmod tempor incididunt ut labore et dolore &lt;span style='color:red;'&gt;magna&lt;/span&gt; aliqua. *Accumsan tortor posuere ac ut consequat semper* ***viverra nam libero.***"
    ), 
   stat = "unique"
  ) 
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-ggtext-textbox-1.png" width="504" style="display: block; margin: auto;" /&gt;
]

---

## Annotations with &lt;b&gt;&lt;code&gt;{ggtext}&lt;/code&gt;&lt;/b&gt;

The `{ggtext}` package also comes with two geom's: `geom_richtext()` and `geom_textbox()`:

.pull-left[

```r
ggplot(data, aes(close, open)) +
  geom_point(size = 2) +
  geom_textbox( 
    aes(
      x = 210, y = 50,  
      label =  "**Lorem ipsum** dolor sit amet, *consectetur adipiscing elit,* sed do eiusmod tempor incididunt ut labore et dolore &lt;span style='color:red;'&gt;magna&lt;/span&gt; aliqua. *Accumsan tortor posuere ac ut consequat semper* ***viverra nam libero.***"
    ), 
    stat = "unique",
*  width = unit(15, "lines")
  ) 
```
]

.pull-right[
&lt;img src="04-annotation_files/figure-html/plot-ggtext-textbox-width-1.png" width="504" style="display: block; margin: auto;" /&gt;
]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"slideNumberFormat": "<div class=\"progress-bar-container\">\n  <div class=\"progress-bar\" style=\"width: calc(%current% / %total% * 100%);\">\n  </div>\n</div>\n",
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
